---
title: Oracleå®è·µæ•°æ®åº“ç¬”è®°-12
description: Oracleæ•°æ®åº“çš„å¤‡ä»½å’Œæ¢å¤
categories:
  - è¯¾ç¨‹
tags:
  - Oracle
---
# Oracleå®è·µæ•°æ®åº“

## æ•°æ®åº“å¤‡ä»½å’Œæ¢å¤

- **éœ€è¦æ•°æ®åº“å¤‡ä»½æ¢å¤çš„æƒ…å†µ** PDF D17090
- **logmnrçš„ä½¿ç”¨**
  - **å¯åŠ¨æ•°æ®åº“è¡¥å……æ—¥å¿—**
    ```sql
      desc v$database ğŸ†—
      select supplementallog from v$database ---ä¸å¤ªç¡®å®šsupplementallog 
      alter database add supplemental log data;ğŸ†—
    ```
  - **äº§ç”Ÿæ•°æ®å­—å…¸æ–‡ä»¶**
    - **è®¾ç½®æ•°æ®å­—å…¸æ–‡ä»¶çš„ç›®çš„åœ°(åˆå§‹åŒ–å‚æ•°)**
    - **äº§ç”Ÿæ•°æ®å­—å…¸æ–‡ä»¶**
    - **äº§ç”Ÿä¸€ä¸ªäº‹åŠ¡**
    - **æ·»åŠ éœ€è¦åˆ†æçš„æ—¥å¿—æ–‡ä»¶**
    - **å¯åŠ¨åˆ†æ**
    - **æŸ¥è¯¢å†…å®¹**
    ```sql
      ---è€å¸ˆæ•™ç¨‹ 
      ---è‡ªå·±è·‘ä¸€éğŸ†—
      ---è®¾ç½®ä¸€ä¸‹ç›®å½•,å¾—å…ˆåœ¨æ–‡ä»¶ç³»ç»Ÿä¸­åˆ›å»ºå¥½æ–‡ä»¶å¤¹
      show parameter utl_file_dir  ğŸ†—
      ---é‡å¯ç”Ÿæ•ˆshutdown immediate&startup , path1ä¸ºä¹‹å‰åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­åˆ›å»ºå¥½çš„æ–‡ä»¶å¤¹è·¯å¾„ ğŸ†—
      alter system set utl_file_dir ='path1' scope=spfile;ğŸ†— ---å†showä¸€éæ˜¯æ²¡æœ‰çš„,é‡å¯æ‰ç”Ÿæ•ˆ 
      execute dbms_logmnr_d.build(dictionary_filename=>'åå­—.ora',dictionary_location=>'path')ğŸ†—
      ---äº§ç”Ÿæ•°æ®æ–‡ä»¶ æäº¤äº‹åŠ¡
      select empno,ename,sal from emp;ğŸ†—
      update emp set sal=5000 where empno=7934;ğŸ†—
      commit;ğŸ†—
      execute dbms_logmnr.add_logfile(LogFileName=>'path2',Options=>dbms_logmnr.new)ğŸ†—
      ---å¦‚æœæ˜¯è¿½åŠ ä¸º.addfile
      select group\#,status from v$log;ğŸ†— ---æŸ¥è¯¢å½“å‰ç»„ current
      select group\#,member from v$logfile;ğŸ†—
      ---å¯¹åº”currentç¼–å·çš„path2=>E:\APP\RES0LIYA\ORADATA\ORCL\REDO02.LOG
      execute dbms_logmnr.start_logmnr(DictFileName=>'path1')ğŸ†— ---æ•°æ®å­—å…¸æ–‡ä»¶åœ¨æ­¤æ­¥ä¹‹å‰åˆ›å»ºå¥½å°±è¡Œ
      ---æŠ¥é”™,sysauxæŠ¥é”™ â—å› ä¸ºæœ¬èº«æ²¡æœ‰è„±æœºæ‰€ä»¥æ²¡æœ‰ç¢°åˆ°è¿™ä¸ªbug
      desc dbs_tablespaces
      select tablespacename,status from dbs_tablespaces
      ---å‘ç°sysauxè„±æœºäº†,è®©å®ƒè”æœºå°±ok
      desc v$logmnr_contentsğŸ†—
      select TIMESTAMP,USERNAME,SQL_REDO from v$logmnr_contentsğŸ†—---ä¸€å®šè¦è®°å¾—é€‰åŠ where
      where SEG_NAME='EMP' and OPERATION='UPDATE'ğŸ†—
      ---è°ƒæ•´æ—¶é—´æ ¼å¼ alter set session nls_date_format=''
    ```
  ![æ•ˆæœå›¾](https://static.notion-static.com/3729c29a-5919-4e8e-8496-e24177713690/Untitled)

- **å¤‡ä»½ç±»å‹**
  - **ç”¨æˆ·ç®¡ç†çš„å¤‡ä»½**
    - **å†·å¤‡ä»½â€”å…³é—­æ•°æ®åº“çš„å¤‡ä»½/ä¸€è‡´æ€§å¤‡ä»½**
      - **æ–‡ä»¶åˆ—è¡¨**
      - **shutdown**
      ```sql
        spool E:\app\luohaobackup\filelist.txt
        show parameter spfile
        select name from v$controlfile;
        select member from v$logfile;
        select name from v$datafile;
        select name from v$tempfile;
        ---æ£€æµ‹ä¸€ä¸‹æ˜¯å¦ä¸ºå­˜æ¡£æ¨¡å¼
        archive log list ---å¦‚æœæ˜¯å­˜æ¡£æ¨¡å¼
        ---å¼€å¯å½’æ¡£æ¨¡å¼
        shutdown immediate
        startup mount ---æ­£å¸¸startup ä¸ºopençŠ¶æ€æ•°æ®åº“æ‰“å¼€,mountä¸ºè£…è½½æ•°æ®åº“,nomountä¸ºå®ä¾‹å¯åŠ¨
        ---
        select name from v$archivelog
        spool off
        create table scott.cold(a varchar(20));
        insert into scott.cold values('before backup');
        select * from scott.cold;
        commit;
        shutdown immediate
        ---åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­å¤åˆ¶ç²˜è´´æ‰€æœ‰æ–‡ä»¶,è·¯å¾„å¯ä»¥åœ¨ä¸Šè¾¹æŸ¥åˆ°
        ---.SPFILEæ–‡ä»¶,å¤–éƒ¨,æ²¡æœ‰shutdownä¸å½±å“
        ---.CTLæ§åˆ¶æ–‡ä»¶,éƒ½æ˜¯ä¸€æ ·
        ---.LOGæ—¥å¿—æ–‡ä»¶
        ---.DBFæ•°æ®æ–‡ä»¶
        ---.ARCå½’æ¡£æ–‡ä»¶
        startup
        insert into scott.cold value('after backup');
        select * from scott.cold;
        shutdown immediate
        ---æ–°å»ºä¸€ä¸ªlogæ–‡ä»¶å¤¹ æ”¾å…¥.CTLå’Œ.LOGæ–‡ä»¶
        startup
        cmd>dbca ---åˆ é™¤æ•°æ®åº“orcl
        ---æ¢å¤ â—
        cmd>oradim -new -sid sales;
        ---æŠŠSPFILEæ”¾å…¥E:\app\Res0liya\product\11.2.0\dbhome_1\database
        ---æ ¹æ®SPFILEçš„å†…å®¹åˆ›å»ºå„ç§ç›®å½•
        select * from v$recoverfile
        recover database
        alter database open
        select * from scott.cold
        
        ---æˆ‘çš„æ“ä½œ
        cortana> net configuration assistant ---é…ç½®ç›‘å¬å™¨
        admin cmd> dbca 
        ---å‚»ç“œå¼åˆ›å»ºå®Œåº“luohaoä¹‹å
        ---net start æœåŠ¡å å¯åŠ¨æœåŠ¡å
        cmd> set oracle_sid=luohao
        cmd> sqlplus ---è¾“å…¥sys as sysdba å¯†ç 
        sql> show parameter db_name;---luohao
        conn scott ---æœªè§£é” è§£é”
        alter user scott account unlock;
        alter user scott identified by tiger;
        conn scott/tiger
      ```

    - **çƒ­å¤‡ä»½ å¯ä»¥åšå…¨å¤‡ä»½ä¹Ÿå¯ä»¥åšéƒ¨åˆ†å¤‡ä»½**
      - **å½’æ¡£æ¨¡å¼**
      - **å¤‡ä»½æ¨¡å¼**
      ```sql
          select tablespace_name from dba_tables
          where table_name='COLD';
          select file_name from dba_data_files
          where tablespace_name='USERS';---åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­æ‹·è´ä¸€ä»½
          select * from v$backup;
          ---å•ä¸ªè¡¨
          alter tablespace users begin backup;---å¼€å¯å¤‡ä»½æ¨¡å¼
          select * from scott.cold;
          insert into scott.cold values('after hot backup');
          commit;
          alter tablespace users offline;
          ç¬¬ 1 è¡Œå‡ºç°é”™è¯¯:
          ORA-01150: æ— æ³•é˜²æ­¢å†™å…¥ - æ–‡ä»¶ 4 è®¾ç½®äº†è”æœºå¤‡ä»½
          ORA-01110: æ•°æ®æ–‡ä»¶ 4: 'E:\APP\RES0LIYA\ORADATA\LUOHAO\USERS01.DBF'
          alter tablespace users end backup;---ç»“æŸå¤‡ä»½æ¨¡å¼
          alter tablespace users offline;---åˆ é™¤users01.dbf,æ‹·è´åŸæ¥çš„å›å»
          alter tablespace users online;
          ORA-01113: æ–‡ä»¶ 4 éœ€è¦ä»‹è´¨æ¢å¤
          ORA-01110: æ•°æ®æ–‡ä»¶ 4: 'E:\APP\RES0LIYA\ORADATA\LUOHAO\USERS01.DBF'
          recover datafile 4;æˆ–è€…alter tablespace users ...
          alter tablespace users online;
          select * from scott.cold;
          ---å¤šä¸ªè¡¨
          alter database begin backup
      ```
      ![æ•ˆæœå›¾](https://static.notion-static.com/4be09484-4e67-4108-8c42-71145a288546/Untitled)

  - **æœåŠ¡å™¨ç®¡ç†çš„å¤‡ä»½ (RMAN)**